<form class="form-horizontal" id="timelapseplus-settings">

    <h3>Paths</h3>
    <div class="control-group">
        <label class="control-label">FFmpeg Path</label>
        <div class="controls">
            <input type="text" data-bind="value: settings.plugins.timelapseplus.ffmpegPath">
            <span class="help-block">The path to the FFmpeg binary. You need to install it manually on your host machine.</span>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">FFprobe Path</label>
        <div class="controls">
            <input type="text" data-bind="value: settings.plugins.timelapseplus.ffprobePath">
            <span class="help-block">Usually FFprobe is located in the same folder as FFmpeg.</span>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Webcam Snapshot URL</label>
        <div class="controls">
            <input type="text" data-bind="value: settings.plugins.timelapseplus.webcamUrl">
            <span class="help-block">The URL must be reachable for OctoPrint and return a still JPG image of the webcam stream.</span>
        </div>
    </div>

    <h3>General</h3>
    <div class="control-group">
        <label class="control-label">Capture Mode</label>
        <div class="controls">
            <select data-bind="value: settings.plugins.timelapseplus.captureMode">
                <option value="COMMAND">Command</option>
                <option value="TIMED">Timer</option>
            </select>
        </div>
    </div>

    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.captureMode() == 'COMMAND'">
        <label class="control-label">Snapshot Command</label>
        <div class="controls">
            <input type="text" data-bind="value: settings.plugins.timelapseplus.snapshotCommand">
            <span class="help-block">Action Command or @-Command that will trigger a snapshot capture. You'll have to include it in your GCODE where you want a snapshot to be triggered.</span>
            <code>; Example GCODE

                ; @-Command like this:
                @<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>

                ; Or Action Command like this:
                M118 A1 action:<span data-bind="text: settings.plugins.timelapseplus.snapshotCommand"></span>
            </code>
        </div>
    </div>

    <div class="control-group" data-bind="visible: settings.plugins.timelapseplus.captureMode() == 'TIMED'">
        <label class="control-label">Timer Interval</label>
        <div class="controls">
            <input type="number" step='1' min="1" max="600" width="5" data-bind="value: settings.plugins.timelapseplus.captureTimerInterval">
            <span class="help-block">Capture Timer Interval in seconds</span>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Render Video after Print</label>
        <div class="controls">
            <input type="checkbox" class="input-block-level" data-bind="checked: settings.plugins.timelapseplus.renderAfterPrint">
            <span class="help-block">When a Print has finished a Render Job will be started with the default Video Format, the first Enhancement Preset and the first Render Preset defined below.</span>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Default Video Output Format</label>
        <div class="controls">
            <select data-bind="valueAllowUnset: true, foreach: parent.videoFormatsGrouped, value: settings.plugins.timelapseplus.defaultVideoFormat">
                <optgroup data-bind="attr: {label: name}, foreach: children">
                    <option data-bind="text: fullName, value: $data.id"></option>
                </optgroup>
            </select>
            <span class="help-block">Maybe not all formats are available on your system or your used FFmpeg version. Please consider changing the Video Format if a Render Job is not successful.</span>
        </div>
    </div>

    <h3>Enhancement</h3>
    <div class="control-group">
        <label class="control-label">Enhancement Presets</label>
        <div class="controls">

            <div class="help-block">Enhancement presets define how the frames should be optimized and filtered before the final video is rendered</div>

            <button class="btn btn-mini" data-bind="click: function(){parent.addEnhancementPreset(settings.plugins.timelapseplus.enhancementPresets)}">
                <i class="fa fa-plus"></i>
                Add Enhancement Preset
            </button>

            <div data-bind="foreach: settings.plugins.timelapseplus.enhancementPresets">
                <div class="preset">
                    <h4 style="margin: 0">Preset #<span data-bind="text: $parent.parent.itemIndex($parent.settings.plugins.timelapseplus.enhancementPresets, $data) + 1"></span></h4>

                    <div>
                        <label class="sub">Name</label>
                        <input type="text" class="input-block-level" data-bind="value: $data.name">
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.enhance">
                            Enable Enhancing
                        </label>
                    </div>

                    <div class="sub-settings">
                        <div data-bind="visible: $data.enhance">
                            <label class="sub">Brightness Factor</label>
                            <input type="number" step='0.01' min="0.01" max="5" width="5" data-bind="value: $data.brightness">
                        </div>

                        <div data-bind="visible: $data.enhance">
                            <label class="sub">Contrast Factor</label>
                            <input type="number" step='0.01' min="0.01" max="5" width="5" data-bind="value: $data.contrast">
                        </div>

                        <div data-bind="visible: $data.enhance">
                            <label class="sub checkbox">
                                <input type="checkbox" data-bind="checked: $data.equalize">
                                Equalize Histogram
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.blur">
                            Enable Blur
                        </label>
                    </div>

                    <div class="sub-settings">
                        <div data-bind="visible: $data.blur">
                            <label class="sub">Blur Radius</label>
                            <input type="number" step='1' placeholder='0' min="1" max="500" width="5" data-bind="value: $data.blurRadius">
                            <span class="help-block">The Blur Radius (in Pixels) defines how blurry the masked areas will be.</span>
                        </div>

                        <div data-bind="visible: $data.blur">
                            <label class="sub">Mask</label>
                            <div>
                                <img style="width:8em" data-bind="visible: $data.blurMask() != null, attr: {src: $data.blurMask() == null ? '' : '/plugin/timelapseplus/maskPreview?id=' + $data.blurMask()}">
                                <div data-bind="visible: $data.blurMask() == null" style="color: red !important">
                                    With Blur enabled you must provide a grayscale blur mask!
                                </div>
                            </div>
                            <button style="margin-top: 1em" class="btn" data-bind="click: $parent.parent.openBlurMask">Import Blur Mask</button>
                            <span class="help-block">Requires a grayscale image, ideally the same resolution as your webcam image. White areas define where the blur is applied on the frames , black areas mean no blur.</span>
                        </div>
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.resize">
                            Enable Resizing
                        </label>
                    </div>
                    <div class="sub-settings">
                        <div data-bind="visible: $data.resize">
                            <label class="sub">Width</label>
                            <input type="number" step='1' placeholder='0' min="10" max="5000" width="5" data-bind="value: $data.resizeW">
                        </div>

                        <div data-bind="visible: $data.resize">
                            <label class="sub">Height</label>
                            <input type="number" step='1' placeholder='0' min="10" max="5000" width="5" data-bind="value: $data.resizeH">
                        </div>
                    </div>

                    <button class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemUp($parent.settings.plugins.timelapseplus.enhancementPresets, $data), click: function(){$parent.parent.moveItemUp($parent.settings.plugins.timelapseplus.enhancementPresets, $data)}">
                        <i class="fa fa-chevron-up"></i>
                    </button>

                    <button style="margin-right: 1em" class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemDown($parent.settings.plugins.timelapseplus.enhancementPresets, $data), click: function(){$parent.parent.moveItemDown($parent.settings.plugins.timelapseplus.enhancementPresets, $data)}">
                        <i class="fa fa-chevron-down"></i>
                    </button>

                    <button class="btn btn-mini" data-bind="click: $parent.parent.openEnhancementPresetPreview">
                        <i class="fa fa-eye"></i>
                        Live Preview
                    </button>

                    <button class="btn btn-mini" data-bind="click: function(){$parent.settings.plugins.timelapseplus.enhancementPresets.remove($data)}, enable: $parent.settings.plugins.timelapseplus.enhancementPresets().length > 1">
                        <i class="fa fa-trash"></i>
                        Remove this Preset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <h3>Rendering</h3>
    <div class="control-group">
        <label class="control-label">Render Presets</label>
        <div class="controls">

            <div class="help-block">Render presets define how the actual video should be rendered</div>

            <button class="btn btn-mini" data-bind="click: function(){parent.addRenderPreset(settings.plugins.timelapseplus.renderPresets)}">
                <i class="fa fa-plus"></i>
                Add Render Preset
            </button>

            <div data-bind="foreach: settings.plugins.timelapseplus.renderPresets">
                <div class="preset">
                    <h4 style="margin: 0">Preset #<span data-bind="text: $parent.parent.itemIndex($parent.settings.plugins.timelapseplus.renderPresets, $data) + 1"></span></h4>

                    <div>
                        <label class="sub">Name</label>
                        <input type="text" class="input-block-level" data-bind="value: $data.name">
                    </div>

                    <div>
                        <label class="sub">Framerate</label>
                        <input type="number" step='1' min="1" max="120" width="5" data-bind="value: $data.framerate">
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.combine">
                            Combine Frames
                        </label>
                        <span class="help-block">Before rendering, multiple frames will be combined to reduce the number of total frames and by that the length of the final video.</span>
                    </div>

                    <div class="sub-settings">
                        <div data-bind="visible: $data.combine">
                            <label class="sub">Chunk Size</label>
                            <input type="number" step='1' min="2" max="100" width="5" data-bind="value: $data.combineSize">
                            <span class="help-block">Defines how many frames should be combined into one chunk.</span>
                        </div>

                        <div data-bind="visible: $data.combine">
                            <label class="sub">Method</label>
                            <select data-bind="value: $data.combineMethod">
                                <option value="DROP">Drop Frames</option>
                                <option value="BLEND">Blend</option>
                                <option value="BLEND_WEIGHTED">Weighted Blend</option>
                            </select>
                            <span class="help-block">When dropping frames, only the last frame of a combined chunk will be used, blending creates a combined frame by mixing all chunk frames into one.</span>
                        </div>
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.fade">
                            Enable Fade
                        </label>
                    </div>

                    <div class="sub-settings">
                        <div data-bind="visible: $data.fade">
                            <label class="sub">Fade-In Duration (ms)</label>
                            <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: $data.fadeInDuration">
                        </div>

                        <div data-bind="visible: $data.fade">
                            <label class="sub">Fade-Out Duration (ms)</label>
                            <input type="number" step='1' min="0" max="10000" width="5" data-bind="value: $data.fadeOutDuration">
                        </div>

                        <div data-bind="visible: $data.fade">
                            <label class="sub">Fade Color</label>
                            <div style="display: flex">
                                <select data-bind="value: $data.fadeColor">
                                    <option value="AliceBlue">AliceBlue</option>
                                    <option value="AntiqueWhite">AntiqueWhite</option>
                                    <option value="Aqua">Aqua</option>
                                    <option value="Aquamarine">Aquamarine</option>
                                    <option value="Azure">Azure</option>
                                    <option value="Beige">Beige</option>
                                    <option value="Bisque">Bisque</option>
                                    <option value="Black">Black</option>
                                    <option value="BlanchedAlmond">BlanchedAlmond</option>
                                    <option value="Blue">Blue</option>
                                    <option value="BlueViolet">BlueViolet</option>
                                    <option value="Brown">Brown</option>
                                    <option value="BurlyWood">BurlyWood</option>
                                    <option value="CadetBlue">CadetBlue</option>
                                    <option value="Chartreuse">Chartreuse</option>
                                    <option value="Chocolate">Chocolate</option>
                                    <option value="Coral">Coral</option>
                                    <option value="CornflowerBlue">CornflowerBlue</option>
                                    <option value="Cornsilk">Cornsilk</option>
                                    <option value="Crimson">Crimson</option>
                                    <option value="Cyan">Cyan</option>
                                    <option value="DarkBlue">DarkBlue</option>
                                    <option value="DarkCyan">DarkCyan</option>
                                    <option value="DarkGoldenRod">DarkGoldenRod</option>
                                    <option value="DarkGray">DarkGray</option>
                                    <option value="DarkGreen">DarkGreen</option>
                                    <option value="DarkKhaki">DarkKhaki</option>
                                    <option value="DarkMagenta">DarkMagenta</option>
                                    <option value="DarkOliveGreen">DarkOliveGreen</option>
                                    <option value="Darkorange">Darkorange</option>
                                    <option value="DarkOrchid">DarkOrchid</option>
                                    <option value="DarkRed">DarkRed</option>
                                    <option value="DarkSalmon">DarkSalmon</option>
                                    <option value="DarkSeaGreen">DarkSeaGreen</option>
                                    <option value="DarkSlateBlue">DarkSlateBlue</option>
                                    <option value="DarkSlateGray">DarkSlateGray</option>
                                    <option value="DarkTurquoise">DarkTurquoise</option>
                                    <option value="DarkViolet">DarkViolet</option>
                                    <option value="DeepPink">DeepPink</option>
                                    <option value="DeepSkyBlue">DeepSkyBlue</option>
                                    <option value="DimGray">DimGray</option>
                                    <option value="DodgerBlue">DodgerBlue</option>
                                    <option value="FireBrick">FireBrick</option>
                                    <option value="FloralWhite">FloralWhite</option>
                                    <option value="ForestGreen">ForestGreen</option>
                                    <option value="Fuchsia">Fuchsia</option>
                                    <option value="Gainsboro">Gainsboro</option>
                                    <option value="GhostWhite">GhostWhite</option>
                                    <option value="Gold">Gold</option>
                                    <option value="GoldenRod">GoldenRod</option>
                                    <option value="Gray">Gray</option>
                                    <option value="Green">Green</option>
                                    <option value="GreenYellow">GreenYellow</option>
                                    <option value="HoneyDew">HoneyDew</option>
                                    <option value="HotPink">HotPink</option>
                                    <option value="IndianRed">IndianRed</option>
                                    <option value="Indigo">Indigo</option>
                                    <option value="Ivory">Ivory</option>
                                    <option value="Khaki">Khaki</option>
                                    <option value="Lavender">Lavender</option>
                                    <option value="LavenderBlush">LavenderBlush</option>
                                    <option value="LawnGreen">LawnGreen</option>
                                    <option value="LemonChiffon">LemonChiffon</option>
                                    <option value="LightBlue">LightBlue</option>
                                    <option value="LightCoral">LightCoral</option>
                                    <option value="LightCyan">LightCyan</option>
                                    <option value="LightGoldenRodYellow">LightGoldenRodYellow</option>
                                    <option value="LightGreen">LightGreen</option>
                                    <option value="LightGrey">LightGrey</option>
                                    <option value="LightPink">LightPink</option>
                                    <option value="LightSalmon">LightSalmon</option>
                                    <option value="LightSeaGreen">LightSeaGreen</option>
                                    <option value="LightSkyBlue">LightSkyBlue</option>
                                    <option value="LightSlateGray">LightSlateGray</option>
                                    <option value="LightSteelBlue">LightSteelBlue</option>
                                    <option value="LightYellow">LightYellow</option>
                                    <option value="Lime">Lime</option>
                                    <option value="LimeGreen">LimeGreen</option>
                                    <option value="Linen">Linen</option>
                                    <option value="Magenta">Magenta</option>
                                    <option value="Maroon">Maroon</option>
                                    <option value="MediumAquaMarine">MediumAquaMarine</option>
                                    <option value="MediumBlue">MediumBlue</option>
                                    <option value="MediumOrchid">MediumOrchid</option>
                                    <option value="MediumPurple">MediumPurple</option>
                                    <option value="MediumSeaGreen">MediumSeaGreen</option>
                                    <option value="MediumSlateBlue">MediumSlateBlue</option>
                                    <option value="MediumSpringGreen">MediumSpringGreen</option>
                                    <option value="MediumTurquoise">MediumTurquoise</option>
                                    <option value="MediumVioletRed">MediumVioletRed</option>
                                    <option value="MidnightBlue">MidnightBlue</option>
                                    <option value="MintCream">MintCream</option>
                                    <option value="MistyRose">MistyRose</option>
                                    <option value="Moccasin">Moccasin</option>
                                    <option value="NavajoWhite">NavajoWhite</option>
                                    <option value="Navy">Navy</option>
                                    <option value="OldLace">OldLace</option>
                                    <option value="Olive">Olive</option>
                                    <option value="OliveDrab">OliveDrab</option>
                                    <option value="Orange">Orange</option>
                                    <option value="OrangeRed">OrangeRed</option>
                                    <option value="Orchid">Orchid</option>
                                    <option value="PaleGoldenRod">PaleGoldenRod</option>
                                    <option value="PaleGreen">PaleGreen</option>
                                    <option value="PaleTurquoise">PaleTurquoise</option>
                                    <option value="PaleVioletRed">PaleVioletRed</option>
                                    <option value="PapayaWhip">PapayaWhip</option>
                                    <option value="PeachPuff">PeachPuff</option>
                                    <option value="Peru">Peru</option>
                                    <option value="Pink">Pink</option>
                                    <option value="Plum">Plum</option>
                                    <option value="PowderBlue">PowderBlue</option>
                                    <option value="Purple">Purple</option>
                                    <option value="Red">Red</option>
                                    <option value="RosyBrown">RosyBrown</option>
                                    <option value="RoyalBlue">RoyalBlue</option>
                                    <option value="SaddleBrown">SaddleBrown</option>
                                    <option value="Salmon">Salmon</option>
                                    <option value="SandyBrown">SandyBrown</option>
                                    <option value="SeaGreen">SeaGreen</option>
                                    <option value="SeaShell">SeaShell</option>
                                    <option value="Sienna">Sienna</option>
                                    <option value="Silver">Silver</option>
                                    <option value="SkyBlue">SkyBlue</option>
                                    <option value="SlateBlue">SlateBlue</option>
                                    <option value="SlateGray">SlateGray</option>
                                    <option value="Snow">Snow</option>
                                    <option value="SpringGreen">SpringGreen</option>
                                    <option value="SteelBlue">SteelBlue</option>
                                    <option value="Tan">Tan</option>
                                    <option value="Teal">Teal</option>
                                    <option value="Thistle">Thistle</option>
                                    <option value="Tomato">Tomato</option>
                                    <option value="Turquoise">Turquoise</option>
                                    <option value="Violet">Violet</option>
                                    <option value="Wheat">Wheat</option>
                                    <option value="White">White</option>
                                    <option value="WhiteSmoke">WhiteSmoke</option>
                                    <option value="Yellow">Yellow</option>
                                    <option value="YellowGreen">YellowGreen</option>
                                </select>
                                <div class="colorPreview" data-bind="style: {'background-color': $data.fadeColor()}"></div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="sub checkbox">
                            <input type="checkbox" data-bind="checked: $data.interpolate">
                            Enable Frame Interpolation
                        </label>
                    </div>

                    <div class="sub-settings">
                        <div data-bind="visible: $data.interpolate">
                            <label class="sub">Interpolated Framerate</label>
                            <input type="number" step='1' min="1" max="120" width="5" data-bind="value: $data.interpolateFramerate">
                        </div>

                        <div data-bind="visible: $data.interpolate">
                            <label class="sub">Mode</label>
                            <select data-bind="value: $data.interpolateMode">
                                <option value="blend">Blending Frames</option>
                                <option value="mci">Motion Compensated</option>
                            </select>
                        </div>

                        <div class="alert alert-block" style="margin-top: 1em" data-bind="visible: $data.interpolate() && $data.interpolateMode() == 'mci'">
                            <strong>Note: </strong>
                            <a href="http://underpop.online.fr/f/ffmpeg/help/minterpolate.htm.gz" target="_blank">Click here</a>
                            for more information about the interpolation parameters. If you are not sure, you can just keep the default settings.
                        </div>

                        <div data-bind="visible: $data.interpolate() && $data.interpolateMode() == 'mci'">
                            <label class="sub">Motion Estimation</label>
                            <select data-bind="value: $data.interpolateEstimation">
                                <option value="bidir">Bidirectional</option>
                                <option value="bilar">Bilateral</option>
                            </select>
                        </div>

                        <div data-bind="visible: $data.interpolate() && $data.interpolateMode() == 'mci'">
                            <label class="sub">Motion Search Algorithm</label>
                            <select data-bind="value: $data.interpolateAlgorithm">
                                <option value="esa">Exhaustive</option>
                                <option value="tss">Three step</option>
                                <option value="tdls">Two dimensional logarithmic</option>
                                <option value="ntss">New three step</option>
                                <option value="fss">Four step</option>
                                <option value="ds">Diamond</option>
                                <option value="hexbs">Hexagon-based</option>
                                <option value="epzs">Enhanced predictive zonal</option>
                                <option value="umh">Uneven multi-hexagon</option>
                            </select>
                        </div>

                        <div data-bind="visible: $data.interpolate() && $data.interpolateMode() == 'mci'">
                            <label class="sub">Motion Compensation</label>
                            <select data-bind="value: $data.interpolateCompensation">
                                <option value="obmc">Normal</option>
                                <option value="aobmc">Adaptive</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemUp($parent.settings.plugins.timelapseplus.renderPresets, $data), click: function(){$parent.parent.moveItemUp($parent.settings.plugins.timelapseplus.renderPresets, $data)}">
                        <i class="fa fa-chevron-up"></i>
                    </button>

                    <button style="margin-right: 1em" class="btn btn-mini" data-bind="enable: $parent.parent.canMoveItemDown($parent.settings.plugins.timelapseplus.renderPresets, $data), click: function(){$parent.parent.moveItemDown($parent.settings.plugins.timelapseplus.renderPresets, $data)}">
                        <i class="fa fa-chevron-down"></i>
                    </button>

                    <button class="btn btn-mini" data-bind="click: function(){$parent.settings.plugins.timelapseplus.renderPresets.remove($data)}, enable: $parent.settings.plugins.timelapseplus.renderPresets().length > 1">
                        <i class="fa fa-trash"></i>
                        Remove this Preset
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<!------------------------------------------------------->

<div id="tlp-modal-enhancement-live-preview" class="modal hide fade">
    <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
        <h3>Live Preview</h3>
    </div>
    <div class="modal-body">
        <div class="row-fluid">
            <img class="preview" />
        </div>

    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
    </div>
</div>